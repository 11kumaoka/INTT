# INTT Example Ana
* Minimal example of a working custom "analysis" package
* You will most likely need something like this for DST analysis
* However, you can build and install any classes you like and use them in other projects (provided you link against this package in the other project)

# General information
* Most everything here can be learned from the sPHENIX Wiki:
	* https://wiki.sphenix.bnl.gov/index.php/Autotools
* However, further instructions exist in this `README.md` file to produce a minimum working example,
* And I will provide links to specific sPHENIX pages and subsections here as well

# Prerequisites
* You should be familiar with the process of building and installing packages existing package for analysis use
* Instructions exist on the Wiki:
	* https://wiki.sphenix.bnl.gov/index.php/Autotools#Building\_an\_existing\_package
	* https://wiki.sphenix.bnl.gov/index.php/Example\_of\_using\_DST\_nodes#Building\_a\_package
* In my opinion, the former link is more helpful
* You should have an install location and an environment variable specifying the path to your install location
	* I would recommend calling this variable `MYINSTALL` as is the sPHENIX convention
	* In your `.bash_rc` or `.bash_profile`, whichever is sourced at login, you should have the following lines:
	* 	`export MYINSTALL=~/path/to/your/install/directory`
	* 	`source /opt/sphenix/core/bin/setup_local.sh $MYINSTALL`
	* You will need to change `~/path/to/your/install/directory` to the actual path

# To Modify this for your own use:
## Edit `configure.ac` 
* You should choose a package name (all lowercase)
	* Installed packages will overwrite existing packages with the same name in their install location
	* If you are not creating an official package, I'd recommend a name-mangling scheme that includes your sPHENIX username
	* For example, I might call something "intt\_josephb"
* Edit only the line in `configure.ac` that is:
	* `AC_INIT(myana, [1.00])`
	* You will need to change the `myana` to the name you picked for your package
	* You can consider changing the version, e.g. `[1.00]` to `[2.00]`
* There are comments in this file re-iterating these points
* For more information:
	* See https://wiki.sphenix.bnl.gov/index.php/Autotools#configure.ac
	* Compare with other `configure.ac` files on the sPHENIX Github
	* For example [INTT's `configure.ac` file](https://github.com/josephbertaux/coresoftware/blob/master/offline/packages/intt/configure.ac)

## Edit `Makefile.am`
* General comments:
	* Use spaces instead of tabs
	* Note the `\` at the end of lines that are continued below
* You should choose a library name
	* This does not need to be lowercase
	* I'd recommend using something similar to what you chose for the package name
* Edit `Makefile.am` to reflect your choice of library name
	* You can do a find and replace: `intt_example_ana` to [your package name]
* Edit `Makefile.am` to use your header and implementation files
	* For each header (`.h`) file you need, add it under the `pkginclude_HEADERS` section
	* For each implementation (`.cc`) file you need, add it under the `libintt_example_ana_la_SOURCES` section
	* I would recommend adding these in alphabetical order
* Edit `Makefile.am` to link against the libraries you package nees to compile
	* Link against the libraries you need under the `libintt_example_ana_la_LIBADD` section
	* Library names are preceeded with the standard linking flag `-l`
	* The paths to these libraries must also be specified under `AM_LDFLAGS`
	* Common libraries and linked directories are already specified in the template
	* Avoid linking against more libraries than you need
* For more information:
	* See https://wiki.sphenix.bnl.gov/index.php/Autotools#Makefile.am
	* Compare with other `configure.ac` files on the sPHENIX Github
	* For example [INTT's `Makefile.am` file](https://github.com/josephbertaux/coresoftware/blob/master/offline/packages/intt/Makefile.am)

## Building
* You will need to created a build directory for your package
	* I would recommended creating a top level directory, and:
	* In that directory, make a subdirectory for building each package you need to compile
* Navigate to this directory and run the autogen script, with the prefix flag set to your install directory:
	* `cd ~/path/to/your/build/directory`
	* `~/path/to/this/directory/autogen.sh --prefix=$MYINSTALL`
* Note that this will produce additional files in the source directory (where this `README.md` file is)
	* Do NOT commit autogenerated source files
	* You can specifically add them to your .gitignore
	* In addition to your codes, only commit: `autogen.sh`, `configure.ac`, and `Makefile.am`
	* You can `git rm` the autogenerated files if you commit them by accident (you'll need to re-build and re-install)
* Once you've run the autogen script from you build directory, you can compile from your build directory
* For more information:
	* See https://wiki.sphenix.bnl.gov/index.php/Autotools#Building\_an\_existing\_package

## Compiling and installing
* Navigate to build directory and run
	* `make -j 8 install`
	* `-j` is a flag that enables GCC multithreading for compilations that don't have cross dependencies
	* `install` indicates the libraries will be moved to your install location, `$MYINSTALL`
	* If `install` is not specified, binaries are built in your build directory and will be moved the next time you run `make install`
* Make detects and only recompiles a subset of what it needs to based on editing
	* For example, it only recompiles object files based on which corresponding source files have been edited
* You will see a distinct output and the messages that `Libraries have been installed under...` if `make install` is successful
	* Otherwise, you will need to debug your code
* For more information:
	* See https://wiki.sphenix.bnl.gov/index.php/Autotools#Building\_an\_existing\_package
## Source codes
* The `InttExampleAna.h` and `InttExampleAna.cc` files were produced with a Perl script as
	* `CreateSubsysRecoModule.pl InttExampleAna`
	* You can mimmick this command to quickly produce a minimal pair of header (`.h`) and implementation (`.cc`) for a `Fun4All` analysis module
	* However, it does not comment out unused arguments
	* 	You will need to comment out the `topNode` pointer until you use it in the function
	*	Or, use it in a trivial way; in either case you need to edit the files to get them to compile with the `-Wall` flag
	* It can be more efficient than copying and performing a find and replace on existing files
* Note that not every code needs to inherit from `SubsysReco` and be specialized for `Fun4All` analysis
* You can create standalone or helper classes that can be compiled into your package and used in other projects

# Notes
* You need to re-build and re-install your package for `Makefile.am` edits to take effect
	* You do not need to re-build and re-install if you've only edited `.h` or `.cc` files already specified
	* However, you still need to navigate to your build directory and recompile

