void ladder_summary (TString folder_name)
{
	//=================cut variable=================
	 //TString folder_name = "/home/5202011/INTT_cal/INTT_cal_test/ladder_cali/02-0028";

	int all_in_one [2][26][128];
	int decoder=0x7F;
	const int number_of_selection = 7;
	int file_of_each_ladder = 2; 

	//1
	double width_noise_cut_high = 4.2;
	double width_noise_cut_low = 2.2; 

	//10
	double entry_cut_low = 280;
	double entry_cut_high = 400;

	//100
	double ampl_entry_cut_high = 200;
	double ampl_entry_cut_low = 170;

	//1000
	double adc0_cut_high = 40;
	double adc0_cut_low  = 28;
	
	//10000
	double unbonded_cut = 4;
	
	//100000
	double slope_pvalue_cut = 0.006;//(5 sigma)
 	
 	//1000000
	double width_pvalue_cut = 0.006;//(5 sigma)

	double TP_cut_high = 25;
	double TP_cut_low  = 40;

	//1 : 0x01
	//10 : 0x02
	//100 : 0x04
	//1000 : 0x08
	//1000 0 : 0x10
	//1000 00 : 0x20
	//1000 000 : 0x40

	//=================cut variable=================

	TString list_buffer;
	vector<TString> list_array;
	list_array.clear();

	ifstream data_list;
	data_list.open(Form("%s/total_file.txt", folder_name.Data()));

	while (1)
	{
		data_list >> list_buffer;
		list_array.push_back(list_buffer);
		if (!data_list.good())
		{
			break;
		}
	}

	ofstream bad_channel_detail;
	bad_channel_detail.open(Form("%s/bad_channel_detail.txt", folder_name.Data()), ios::out); 
	if (!bad_channel_detail)
	{ 
		cout << "Fail to open file: " << endl;
	}


	TFile *f1;// = TFile::Open(Form("cut_finder_folder/sum_up_all.root"));

	TTree *chan_gaus_width;// = (TTree *)f1->Get("chan_gaus_width"); //value_W
	TTree *chan_entry;// = (TTree *)f1->Get("chan_entry"); //value_E
	TTree *ampl_channel_entries;// = (TTree *)f1->Get("ampl_channel_entries"); //value_EA
	TTree *chan_thre_position;// = (TTree *)f1->Get("chan_thre_position"); //value_TP
	TTree *chan_adc_study;// = (TTree *)f1->Get("chan_adc_study"); //value_adc_0
	TTree *chan_study ;// = (TTree *)f1->Get("chan_study"); //value_slope_chi, value_width_chi


	int chip_W, chan_W;
	double value_W;

	int chip_E, chan_E;
	int value_E;

	int chip_EA, chan_EA;
	int value_EA;

	int chip_TP, chan_TP;
	double value_TP;

	int chip_adc, chan_adc;
	double value_adc_0;

	int chip_chi, chan_chi;
	double value_slope_chi, value_width_chi;
	double value_slope_value, value_width_value;

	int bad_chan_0=0;
	int bad_chan_1=0;

	// vector<int> bad_chip_W; bad_chip_W.clear();
	// vector<int> bad_chan_W; bad_chan_W.clear();
	// vector<int> bad_value_W; bad_value_W.clear(); // width -> 1

	// vector<int> bad_chip_E; bad_chip_E.clear();
	// vector<int> bad_chan_E; bad_chan_E.clear();
	// vector<int> bad_value_E; bad_value_E.clear(); // entry ->10

	// vector<int> bad_chip_EA; bad_chip_EA.clear();
	// vector<int> bad_chan_EA; bad_chan_EA.clear();
	// vector<int> bad_value_EA; bad_value_EA.clear(); // entry after ampl cut ->100

	// vector<int> bad_chip_adc0; bad_chip_adc0.clear();
	// vector<int> bad_chan_adc0; bad_chan_adc0.clear();
	// vector<int> bad_value_adc0; bad_value_adc0.clear(); // mean of adc0 ->1000

	// vector<int> bad_chip_UB; bad_chip_UB.clear();
	// vector<int> bad_chan_UB; bad_chan_UB.clear();
	// vector<int> bad_value_UB; bad_value_UB.clear(); //unbonded channel ->10000

	// vector<int> bad_chip_SC; bad_chip_SC.clear();
	// vector<int> bad_chan_SC; bad_chan_SC.clear();
	// vector<int> bad_value_SC; bad_value_SC.clear(); //slope chi2 ->100000

	// vector<int> bad_chip_WC; bad_chip_WC.clear();
	// vector<int> bad_chan_WC; bad_chan_WC.clear();
	// vector<int> bad_value_WC; bad_value_WC.clear(); //width chi2 ->1000000

	int file_ID = 0; 
	
	for (int i=0; i<2; i++)
	{
		for (int i1=0; i1<26; i1++)
		{
			for (int i2=0; i2<128; i2++)
			{
				all_in_one[i][i1][i2]=decoder;
			}
		}
	}



	for (int i=0; i<2; i++)
	{
		

		for (int i1=0; i1<file_of_each_ladder; i1++)
		{
			//cout<<"test : "<<file_ID<<endl;
			f1 = TFile::Open(Form("%s/folder_%s/%s_summary.root",folder_name.Data(),list_array[file_ID].Data(),list_array[file_ID].Data()));

			chan_gaus_width = (TTree *)f1->Get("chan_gaus_width"); //value_W
			chan_entry = (TTree *)f1->Get("chan_entry"); //value_E
			ampl_channel_entries = (TTree *)f1->Get("ampl_channel_entries"); //value_EA
			chan_thre_position = (TTree *)f1->Get("chan_thre_position"); //value_TP
			chan_adc_study = (TTree *)f1->Get("chan_adc_study"); //value_adc_0
			chan_study = (TTree *)f1->Get("chan_study"); //value_slope_chi, value_width_chi

			chan_gaus_width->SetBranchAddress("chip_id", &chip_W);
			chan_gaus_width->SetBranchAddress("chan_id", &chan_W);
			chan_gaus_width->SetBranchAddress("Gaus_width", &value_W);

			chan_entry->SetBranchAddress("chip_id",&chip_E);
			chan_entry->SetBranchAddress("chan_id",&chan_E);
			chan_entry->SetBranchAddress("chan_entry",&value_E);

			ampl_channel_entries->SetBranchAddress("chip_id",&chip_EA);
			ampl_channel_entries->SetBranchAddress("chan_id",&chan_EA);
			ampl_channel_entries->SetBranchAddress("chan_entry",&value_EA);

			chan_thre_position->SetBranchAddress("chip_id",&chip_TP);
			chan_thre_position->SetBranchAddress("chan_id",&chan_TP);
			chan_thre_position->SetBranchAddress("TP_turnon",&value_TP);

			chan_adc_study->SetBranchAddress("chip_id",&chip_adc);
			chan_adc_study->SetBranchAddress("chan_id",&chan_adc);
			chan_adc_study->SetBranchAddress("adc0",&value_adc_0);

			chan_study->SetBranchAddress("chip_id",&chip_chi);
			chan_study->SetBranchAddress("chan_id",&chan_chi);
			chan_study->SetBranchAddress("slope_value",&value_slope_value);
			chan_study->SetBranchAddress("slope_rchi2",&value_slope_chi);
			chan_study->SetBranchAddress("width_value",&value_width_value);
			chan_study->SetBranchAddress("width_rchi2",&value_width_chi);

			int total_size_W = chan_gaus_width->GetEntriesFast();
			int total_size_E = chan_entry->GetEntriesFast();
			int total_size_EA = ampl_channel_entries->GetEntriesFast();
			int total_size_TP = chan_thre_position->GetEntriesFast();
			int total_size_adc = chan_adc_study->GetEntriesFast();
			int total_size_chi = chan_study->GetEntriesFast();

			cout<<"width :              "<<total_size_W<<endl;
			cout<<"entry :              "<<total_size_E<<endl;
			cout<<"ampl entry :         "<<total_size_EA<<endl;
			cout<<"threshold position : "<<total_size_TP<<endl;
			cout<<"adc :                "<<total_size_adc<<endl;
			cout<<"rchi2 :              "<<total_size_chi<<endl;
			cout<<" "<<endl;

			if (i1==0)
			{
				for (int i2=0; i2<total_size_chi; i2++)
				{
					chan_gaus_width->GetEntry(i2);
					// chan_entry->GetEntry(i2);
					// ampl_channel_entries->GetEntry(i2);
					// chan_thre_position->GetEntry(i2);
					// chan_adc_study->GetEntry(i2);
					// chan_study->GetEntry(i2);
					
					if (value_W<unbonded_cut && value_W !=0 )
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x10;
					}

				}
			}

			else 
			{				
				for (int i2=0; i2<total_size_chi; i2++)
				{
					chan_gaus_width->GetEntry(i2);
					chan_entry->GetEntry(i2);
					ampl_channel_entries->GetEntry(i2);
					chan_thre_position->GetEntry(i2);
					chan_adc_study->GetEntry(i2);
					chan_study->GetEntry(i2);

					if (value_W<width_noise_cut_low || value_W>width_noise_cut_high)//1
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x01;
					}
					if (value_E<entry_cut_low || value_E>entry_cut_high )
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x02;
					}

					if (value_EA<ampl_entry_cut_low || value_EA>ampl_entry_cut_high )
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x04;
					}

					if (value_adc_0<adc0_cut_low || value_adc_0>adc0_cut_high )
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x08;
					}

					if (value_slope_chi<slope_pvalue_cut)
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x020;
					}

					if (value_width_chi<width_pvalue_cut)
					{
						all_in_one[i][chip_W-1][chan_W]=all_in_one[i][chip_W-1][chan_W]^0x40;
					}

				}		
			}

			file_ID +=1;

		}
	}
	
	int ladder_B, chip_B, chan_B, decoder_B;
	int bad_channel;

	TFile *file_output = new TFile(Form("%s/bad_channel_summary.root", folder_name.Data()), "RECREATE");
	TTree *tree_output1 = new TTree("bad_channel_detail", Form("the detail of bad channel"));
	TTree *tree_output2 = new TTree("total_number", Form("total number of bad channels of this ladder"));

	tree_output1->Branch("ladder_id", &ladder_B);
	tree_output1->Branch("chip_id", &chip_B);
	tree_output1->Branch("chan_id", &chan_B);
	tree_output1->Branch("decoder", &decoder_B);

	tree_output2->Branch("bad_channel",&bad_channel);

	TCanvas * c1 = new TCanvas ("c1","c1",1200,800);
	c1->cd();

	TH2F * bad_channel_map = new TH2F ("","bad channel map",52,1,53,128,0,128);
	bad_channel_map->GetXaxis()->SetTitle("Chip ID");
	bad_channel_map->GetYaxis()->SetTitle("Channel ID");
	bad_channel_map->SetStats(0);

	for (int i1=0; i1<26; i1++)
	{
		for (int i2=0; i2<128; i2++)
		{	
			if (all_in_one[0][i1][i2]!= decoder)
			{
				cout<<"bad channel in ladder 0, chip : "<<i1+1<<"	channel : "<<i2<<"	decode : "<<std::bitset<number_of_selection>(all_in_one[0][i1][i2])<<endl;
				bad_chan_0 +=1;

				ladder_B = 0;
				chip_B = i1+1;
				chan_B = i2;
				decoder_B = all_in_one[0][i1][i2];
				tree_output1->Fill();
				bad_channel_map->Fill(i1+1,i2);

				bad_channel_detail<< 0 <<"	"<<i1+1<<"	"<<i2<<"	"<<std::bitset<number_of_selection>(all_in_one[0][i1][i2])<<"\r"<<endl;
			}
		}
	}	
	
	cout<<" "<<endl;
	cout<<"================================================================================="<<endl;
	cout<<"================================================================================="<<endl;
	cout<<"================================================================================="<<endl;
	cout<<"================================================================================="<<endl;
	cout<<" "<<endl;
	for (int i1=0; i1<26; i1++)
	{
		for (int i2=0; i2<128; i2++)
		{
			if (all_in_one[1][i1][i2]!= decoder)
			{
				cout<<"bad channel in ladder 1, chip : "<<i1+1<<"	channel : "<<i2<<"	decode : "<<std::bitset<number_of_selection>(all_in_one[1][i1][i2])<<endl;
				bad_chan_1 +=1;

				ladder_B = 1;
				chip_B = i1+1;
				chan_B = i2;
				decoder_B = all_in_one[1][i1][i2];
				tree_output1->Fill();
				bad_channel_map->Fill(i1+1+26,i2);

				bad_channel_detail<< 1 <<"	"<<i1+1<<"	"<<i2<<"	"<<std::bitset<number_of_selection>(all_in_one[1][i1][i2])<<"\r"<<endl;
			}
		}
	}	
	
	bad_channel_map->Draw("colz0");
	c1->Print(Form("%s/bad_channel_map.pdf",folder_name.Data()));

	cout<<" "<<endl;
	cout<<"////////////////////////////"<<endl;
	cout<<"////  final results   //////"<<endl;
	cout<<"////////////////////////////"<<endl;	
	cout<<" "<<endl;
	cout<<"Ladder0 bad channel : "<<bad_chan_0<<" ladder1 bad channel : "<<bad_chan_1<<endl;
	cout<<"Total bad channel   : "<<bad_chan_1+bad_chan_0<<" total performance : "<<Form("%.5f",((6656.-double(bad_chan_1+bad_chan_0))/6656.))<<endl;
	

	bad_channel = bad_chan_1+bad_chan_0;
	tree_output2->Fill();

	tree_output1->Write("", TObject::kOverwrite);
	tree_output2->Write("", TObject::kOverwrite);

	bad_channel_detail<<"\r"<<endl;	
	bad_channel_detail<<"total bad channel : "<<bad_chan_1+bad_chan_0<<"\r"<<endl;

	file_output->Close();
	bad_channel_detail.close();


}



